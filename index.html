<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="theme-color" content="#0a0e17" />
    <title>Groot FRP Planters - Pricing Console</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        input::placeholder {
            color: #1c2d46 !important;
            opacity: 0.5;
        }

        :root {
            /* 1. AI SUPER COOL DARK THEME - Perfect Readability */
            --bg-page: #0a0e17;
            --bg-card: #111827;
            --bg-header: linear-gradient(135deg, #1e1b4b, #1e3a8a, #3b82f6);
            --bg-section-top: #1e293b;
            --border-soft: rgba(75,85,99,0.4);
            --border-light: rgba(148,163,184,0.6);
            --accent: #60a5fa;
            --accent-soft: rgba(96,165,250,0.2);
            --accent-glow: rgba(96,165,250,0.4);
            --success: #34d399;
            --danger: #f87171;
            --text-main: #f8fafc;
            --text-muted: #cbd5e1;
            --text-invert: #f1f5f9;
            /* NEW: Input field perfection */
            --input-bg: rgba(255,255,255,0.12);
            --input-text: #f1f5f9;
            --input-placeholder: #1c2d46;
            --input-border: rgba(148,163,184,0.6);
        }

        [data-theme="light"] {
            /* 2. Light Theme - Professional Readable */
            --bg-page: #f1f5f9;
            --bg-card: #ffffff;
            --bg-header: linear-gradient(135deg, #1e40af, #3b82f6);
            --bg-section-top: #1d4ed8;
            --border-soft: rgba(148,163,184,0.8);
            --border-light: rgba(71,85,105,0.9);
            --accent: #2563eb;
            --accent-soft: rgba(37,99,235,0.15);
            --accent-glow: rgba(37,99,235,0.35);
            --success: #10b981;
            --danger: #ef4444;
            --text-main: #0f172a;
            --text-muted: #475569;
            --text-invert: #ffffff;
            --input-bg: rgba(255,255,255,0.9);
            --input-text: #0f172a;
            --input-placeholder: rgba(71,85,105,0.6);
            --input-border: rgba(71,85,105,0.5);
        }

        [data-theme="semi-dark"] {
            /* 3. AI SUPER COOL SEMI-DARK - PERFECT BALANCE + READABILITY */
            --bg-page: #0f1419;
            --bg-card: #1f2937;
            --bg-header: linear-gradient(135deg, #1e40af, #3b82f6, #60a5fa);
            --bg-section-top: #111827;
            --border-soft: rgba(107,114,128,0.5);
            --border-light: rgba(156,163,175,0.7);
            --accent: #60a5fa;
            --accent-soft: rgba(96,165,250,0.25);
            --accent-glow: rgba(96,165,250,0.45);
            --success: #34d399;
            --danger: #f87171;
            --text-main: #f8fafc;
            --text-muted: #d1d5db;
            --text-invert: #f9fafb;
            /* PERFECT INPUT VISIBILITY */
            --input-bg: rgba(255,255,255,0.15);
            --input-text: #f8fafc;
            --input-placeholder: #1c2d46;
            --input-border: rgba(156,163,175,0.7);
        }

        [data-theme="garden"] {
            /* 4. ðŸŒ¿ Garden Theme - Gardening Inspired */
            --bg-page: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-card: rgba(255,255,255,0.95);
            --bg-header: linear-gradient(135deg, #56ab2f, #a8e6cf);
            --bg-section-top: linear-gradient(135deg, #27ae60, #2ecc71);
            --border-soft: rgba(46,204,113,0.3);
            --border-light: rgba(39,174,96,0.5);
            --accent: #27ae60;
            --accent-soft: rgba(39,174,96,0.2);
            --accent-glow: rgba(39,174,96,0.4);
            --success: #f39c12;
            --danger: #e74c3c;
            --text-main: #2c3e50;
            --text-muted: #7f8c8d;
            --text-invert: #ffffff;
            --input-bg: rgba(255,255,255,0.92);
            --input-text: #2c3e50;
            --input-placeholder: rgba(44,62,80,0.7);
            --input-border: rgba(39,174,96,0.4);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-page);
            color: var(--text-main);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            line-height: 1.6;
        }

        /* THEME CONTROL - Material UI Style */
        .theme-control {
            position: fixed;
            top: 8px;
            right: 5px;
            z-index: 1050;
        }

        .theme-trigger {
            width: 56px;
            height: 56px;
            background: var(--bg-card);
            border-radius: 16px;
            border: 2px solid var(--border-soft);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--accent);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
        }

        .theme-trigger:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border-color: var(--accent);
        }

        .theme-trigger i { transition: transform 0.3s ease; }
        .theme-trigger:hover i { transform: rotate(90deg); }

        .theme-dropdown {
            position: absolute;
            top: 70px;
            right: 0;
            min-width: 140px;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-soft);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            padding: 16px;
        }

        .theme-control:hover .theme-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .theme-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: 2px solid transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .theme-btn:hover {
            transform: translateY(-2px) scale(1.05);
            border-color: var(--accent);
        }

        .theme-btn.active {
            border-color: var(--accent);
            background: var(--accent-soft);
            color: var(--accent);
            box-shadow: 0 0 0 4px var(--accent-glow);
        }

        .theme-btn.light { background: linear-gradient(135deg, #f1f5f9, #e2e8f0); }
        .theme-btn.dark { background: linear-gradient(135deg, #0a0e17, #111827); }
        .theme-btn.semi-dark { background: linear-gradient(135deg, #0f1419, #1f2937); }
        .theme-btn.garden { 
            background: linear-gradient(135deg, #56ab2f, #a8e6cf);
            color: white;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        /* MAIN CONSOLE - Material UI + Bootstrap */
        .console {
            max-width: 100%;
            margin: 0 auto;
            background: var(--bg-card);
            border-radius: 24px;
            border: 1px solid var(--border-soft);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .console-header {
            background: var(--bg-header);
            padding: 2rem 2.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-invert);
        }

        .console-title {
            font-size: 1.875rem;
            font-weight: 800;
            margin: 0;
            letter-spacing: -0.025em;
        }

        .status-live {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            background: rgba(255,255,255,0.15);
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success);
            box-shadow: 0 0 0 3px rgba(52,211,153,0.3);
        }

        /* SECTIONS */
        .section:not(:first-child) {
            border-top: 1px solid var(--border-soft);
        }

        .section-header {
            background: var(--bg-section-top);
            padding: 1rem 1.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            color: var(--text-invert);
            font-size: 0.9375rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            margin: 0;
        }

        .section-subtitle {
            color: rgba(255,255,255,0.75);
            font-size: 0.8125rem;
            margin-top: 0.25rem;
            font-weight: 400;
        }

        .section-badge {
            background: rgba(255,255,255,0.15);
            color: var(--text-invert);
            padding: 0.375rem 1rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .section-body {
            padding: 1.75rem 2rem;
        }

        /* FORM ELEMENTS - AI PERFECTED FOR ALL THEMES */
        .form-label {
            font-size: 0.8125rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .form-control, .form-select {
            /* background: var(--input-bg) !important; */
            border: 1px solid var(--input-border) !important;
            border-radius: 12px;
            padding: 0.875rem 1rem;
            font-size: 0.9375rem;
            color: #1c2d46 !important;
            backdrop-filter: blur(15px);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }

        .form-control::placeholder {
            color: var(--input-placeholder) !important;
            opacity: 1 !important;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--accent) !important;
            box-shadow: 0 0 0 0.25rem var(--accent-glow);
            /* background: rgba(255,255,255,0.18) !important; */
            outline: none;
            transform: translateY(-1px);
            color: #1c2d46 !important;
        }

        input[readonly] {
            background: rgba(255,255,255,0.06) !important;
            opacity: 0.85;
            color: var(--input-text) !important;
        }

        input[readonly]::placeholder {
            color: var(--input-placeholder) !important;
        }

        /* TABLES */
        .items-table {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border-soft);
            backdrop-filter: blur(10px);
        }

        .items-table thead th {
            background: rgba(255,255,255,0.1);
            color: var(--text-muted);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            padding: 1rem 0.75rem;
            font-weight: 600;
        }

        .items-table tbody td {
            padding: 1rem 0.75rem;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }

        /* Input tables fix */
        .items-table .form-control {
            background: rgb(255 255 255) !important;
            color: #000000 !important;
            border: 1px solid var(--input-border) !important;
        }

        .items-table .form-control::placeholder {
            color: var(--input-placeholder) !important;
        }

        /* MATERIAL UI BUTTONS with FontAwesome */
        .btn-add-remove {
            border-radius: 50px !important;
            font-weight: 600 !important;
            border: none !important;
            padding: 0.625rem 1.25rem !important;
            font-size: 0.875rem !important;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
            box-shadow: 0 4px 14px 0 rgb(0 0 0 / 0.2) !important;
            min-height: 44px;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 0.5rem;
        }

        .btn-add {
            background: var(--accent) !important;
            color: white !important;
        }

        .btn-add:hover {
            background: color-mix(in srgb, var(--accent) 90%, black) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(96,165,250,0.4) !important;
        }

        .btn-remove {
            background: var(--danger) !important;
            color: white !important;
            min-width: 44px !important;
        }

        .btn-remove:hover {
            background: color-mix(in srgb, var(--danger) 90%, black) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(248,113,113,0.4) !important;
        }

        /* TOTAL CARDS */
        .total-card {
            border-radius: 20px;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(20px);
            border: 1px solid transparent;
            box-shadow: 0 10px 25px rgb(0 0 0 / 0.1);
        }

        .grand-total-card { background: rgba(52,211,153,0.15); border-color: rgba(52,211,153,0.3); }
        .base-total-card { background: rgba(96,165,250,0.15); border-color: rgba(96,165,250,0.3); }

        .total-label {
            font-size: 0.8125rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            font-weight: 500;
        }

        .total-value {
            font-size: 2.25rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }

        /* PROFIT METRICS */
        .profit-metrics {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            border: 1px solid var(--border-soft);
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            margin-top: 1rem;
        }

        .profit-positive .form-control {
            background: rgba(52,211,153,0.18) !important;
            border-color: rgba(52,211,153,0.4) !important;
            color: var(--input-text) !important;
        }

        .profit-negative .form-control {
            background: rgba(248,113,113,0.18) !important;
            border-color: rgba(248,113,113,0.4) !important;
            color: var(--input-text) !important;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            body { padding: 1rem; }
            .console-header, .section-body { padding-left: 1.5rem; padding-right: 1.5rem; }
            .total-card { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .theme-control { top: 15px; right: 15px; }
            .theme-trigger { width: 48px; height: 48px; font-size: 18px; }
            .console { max-width: 100%; }
        }
    </style>
</head>
<body data-theme="dark">
    <!-- THEME CONTROL - 4 Themes with Icons -->
    <div class="theme-control">
        <div class="theme-trigger">
            <i class="fas fa-palette"></i>
        </div>
        <div class="theme-dropdown">
            <div class="theme-buttons">
                <button class="theme-btn dark" data-theme="dark" title="ðŸš€ Super Dark">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="theme-btn light" data-theme="light" title="â˜€ï¸ Light">
                    <i class="fas fa-sun"></i>
                </button>
                <button class="theme-btn semi-dark active" data-theme="semi-dark" title="âš¡ Semi-Dark">
                    <i class="fas fa-adjust"></i>
                </button>
                <button class="theme-btn garden" data-theme="garden" title="ðŸŒ¿ Garden">
                    <i class="fas fa-seedling"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="console">
        <!-- HEADER -->
        <div class="console-header">
            <h1 class="console-title">Groot FRP Planters - Pricing Console</h1>
            <div class="status-live">
                <div class="status-dot"></div>
                <span id="current-theme">DARK THEME</span>
            </div>
        </div>

        <!-- SECTION 1: Rate Calculator -->
        <div class="section">
            <div class="section-header">
                <div>
                    <h3 class="section-title">Rate Calculator</h3>
                    <div class="section-subtitle">Rate â†’ Base (+10%) â†’ Final (-15%)</div>
                </div>
                <span class="section-badge">âœ… PERFECT</span>
            </div>
            <div class="section-body">
                <div class="row g-3">
                    <div class="col-lg-4">
                        <label class="form-label" for="rate">Rate (â‚¹)</label>
                        <input type="number" class="form-control" id="rate" placeholder="Enter rate" min="0" step="0.1">
                    </div>
                    <div class="col-lg-4">
                        <label class="form-label" for="baseAmount">Base Amount</label>
                        <input type="number" class="form-control" id="baseAmount" readonly>
                    </div>
                    <div class="col-lg-4">
                        <label class="form-label" for="finalAmount">Final Amount</label>
                        <input type="number" class="form-control" id="finalAmount" readonly>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 2: KG Pricing Engine -->
        <div class="section">
            <div class="section-header">
                <div>
                    <h3 class="section-title">KG Pricing Engine</h3>
                    <div class="section-subtitle">Min/Max KG â†’ Average Ã— Finish Rate Ã— Quantity</div>
                </div>
                <span class="section-badge">Section 2</span>
            </div>
            <div class="section-body">
                <div class="row g-3 mb-4">
                    <div class="table-responsive">
                        <table class="table items-table">
                            <thead class="text-center">
                                <tr>
                                    <th>Min KG</th>
                                    <th>Max KG</th>
                                    <th>Avg KG</th>
                                    <th>Finish Rate</th>
                                    <th>Qty</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><input type="number" class="form-control" id="minKg" placeholder="25" min="0" step="0.1"></td>
                                    <td><input type="number" class="form-control" id="maxKg" placeholder="40" min="0" step="0.1"></td>
                                    <td><input type="number" class="form-control" id="avgKg" readonly step="0.1"></td>
                                    <td>
                                        <select class="form-select" id="finishType">
                                            <option value="200">Basic - â‚¹200/kg</option>
                                            <option value="250">Standard - â‚¹250/kg</option>
                                            <option value="300">Advanced - â‚¹300/kg</option>
                                            <option value="350">Texture - â‚¹350/kg</option>
                                            <option value="375">Rustic - â‚¹375/kg</option>
                                            <option value="500">Matt - â‚¹500/kg</option>
                                            <option value="575">Gloss - â‚¹575/kg</option>
                                        </select>
                                    </td>
                                    <td><input type="number" class="form-control" id="kgQty" placeholder="1" min="0" step="1" value="1"></td>
                                    <td><button type="button" class="btn btn-add-remove btn-add" id="addKgRow"><i class="fas fa-plus"></i> Add</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="table-responsive mb-4">
                    <table class="table items-table" id="kgTable">
                        <thead>
                            <tr>
                                <th>#</th><th>Avg KG</th><th>Finish Rate</th><th>Qty</th><th>Base Amount</th><th></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="base-total-card total-card">
                    <div>
                        <div class="total-label">Base Amount Grand Total</div>
                        <div class="form-label">Section 2 â†’ Flows to Cost Calculation</div>
                    </div>
                    <div class="total-value"><span id="kgGrandTotal">0.00</span></div>
                </div>
            </div>
        </div>

        <!-- SECTION 3: Items -->
        <div class="section">
            <div class="section-header">
                <div>
                    <h3 class="section-title">Items (Amount Ã— KG)</h3>
                    <div class="section-subtitle">Selling Price = Grand Total of all lines</div>
                </div>
                <span class="section-badge">Section 3</span>
            </div>
            <div class="section-body">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div class="form-label mb-0">Price Ã— QTY = Line Total â†’ Grand Total = Selling Price</div>
                    <button type="button" class="btn btn-add-remove btn-add" id="addItemRow"><i class="fas fa-plus"></i> Add Item</button>
                </div>
                <div class="table-responsive">
                    <table class="table items-table" id="itemsTable">
                        <thead>
                            <tr>
                                <th>#</th><th>Price</th><th>QTY</th><th>Line Total</th><th></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="grand-total-card total-card">
                    <div>
                        <div class="total-label">Selling Price (Grand Total)</div>
                        <div class="form-label">Selling Price - Base Amount = <span id="yourTotalCostDisplay">0.00</span></div>
                    </div>
                    <div class="total-value"><span id="grandTotal">0.00</span></div>
                </div>
            </div>
        </div>

        <!-- SECTION 4: Profit / Loss -->
        <div class="section">
            <div class="section-header">
                <div>
                    <h3 class="section-title">Profit / Loss</h3>
                    <div class="section-subtitle">Auto Calculations with Discount</div>
                </div>
                <span class="section-badge">Section 4</span>
            </div>
            <div class="section-body">
                <div class="row g-4 mb-4">
                    <div class="col-lg-6">
                        <label class="form-label" for="totalCostInput">Your Total Cost (â‚¹)</label>
                        <input type="number" class="form-control" id="totalCostInput" placeholder="Auto: Selling - Base Amount" readonly>
                    </div>
                    <div class="col-lg-6">
                        <label class="form-label" for="discountInput">Additional Discount (â‚¹)</label>
                        <input type="number" class="form-control" id="discountInput" placeholder="Enter Discount value in (â‚¹)" min="0" step="0.1" value="0">
                    </div>
                </div>
                <div class="row g-3 profit-metrics">
                    <div class="col-lg-3">
                        <div class="profit-field">
                            <label class="form-label" for="showBaseTotal">Base Amount Total</label>
                            <input type="number" class="form-control" id="showBaseTotal" readonly>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="profit-field">
                            <label class="form-label" for="showTotalSell">Total Selling</label>
                            <input type="number" class="form-control" id="showTotalSell" readonly>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="profit-field" id="profitField">
                            <label class="form-label" for="discountedPrice">Discounted Price</label>
                            <input type="number" class="form-control" id="discountedPrice" readonly>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="profit-field" id="percentField">
                            <label class="form-label" for="profitAmount">Profit/Loss (â‚¹)</label>
                            <input type="number" class="form-control" id="profitAmount" readonly>
                        </div>
                    </div>
                </div>
                <div class="row g-3 mt-4">
                    <div class="col-12 text-center">
                        <label class="form-label" for="profitPercent">Profit/Loss (%)</label>
                        <input type="text" class="form-control" id="profitPercent" readonly style="font-size: 2rem; font-weight: 800;">
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 5: Export CSV -->
        <div class="section">
            <div class="section-header">
                <div>
                    <h3 class="section-title">Export Record</h3>
                    <div class="section-subtitle">Save this calculation as CSV</div>
                </div>
                <span class="section-badge">Section 5</span>
            </div>
            <div class="section-body">
                <div class="row g-3 mb-4">
                    <div class="col-lg-4">
                        <label class="form-label" for="partyName">Party Name</label>
                        <input type="text" class="form-control" id="partyName" placeholder="Enter party / customer name">
                    </div>
                    <div class="col-lg-4">
                        <label class="form-label" for="recordDate">Date</label>
                        <input type="date" class="form-control" id="recordDate">
                    </div>
                    <div class="col-lg-4">
                        <label class="form-label" for="recordTime">Time</label>
                        <input type="time" class="form-control" id="recordTime">
                    </div>
                </div>
                <button type="button" class="btn btn-add-remove btn-add w-100" id="exportCsvBtn">
                    <i class="fas fa-download"></i> Download CSV
                </button>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let itemRowCounter = 0;
        let kgRowCounter = 0;
        let currentTheme = 'dark';
        let baseAmountTotal = 0;

        // 4 THEME SYSTEM with Icons
        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            currentTheme = theme;
            $('.theme-btn').removeClass('active');
            $(`.theme-btn[data-theme="${theme}"]`).addClass('active');
            
            const themeNames = {
                'dark': 'DARK THEME',
                'light': 'LIGHT THEME',
                'semi-dark': 'SEMI-DARK THEME',
                'garden': 'ðŸŒ¿ GARDEN THEME'
            };
            $('#current-theme').text(themeNames[theme]);
            localStorage.setItem('preferredTheme', theme);
        }

        $('.theme-btn').click(function(e) {
            e.stopPropagation();
            const theme = $(this).data('theme');
            setTheme(theme);
        });

        $(document).ready(function() {
            const savedTheme = localStorage.getItem('preferredTheme') || 'dark';
            setTheme(savedTheme);
            
            const now = new Date();
            const pad = n => String(n).padStart(2, '0');
            $('#recordDate').val(`${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}`);
            $('#recordTime').val(`${pad(now.getHours())}:${pad(now.getMinutes())}`);
            
            addItemRow(); // Add first item row
            calcSingleKG();
        });

        // SECTION 1: Rate Calculator (UNCHANGED)
        $('#rate').on('input', function() {
            let rate = parseFloat(this.value) || 0;
            if (rate < 0) rate = 0;
            let base = rate * 1.1;
            let final = base * 0.85;
            $('#baseAmount').val(base.toFixed(2));
            $('#finalAmount').val(final.toFixed(2));
        });

        // SECTION 2: KG Pricing (UNCHANGED)
        function calcSingleKG() {
            let min = parseFloat($('#minKg').val()) || 0;
            let max = parseFloat($('#maxKg').val()) || 0;
            let avg = ((min + max) / 2).toFixed(2);
            $('#avgKg').val(avg);
        }

        $('#minKg, #maxKg').on('input', calcSingleKG);

        function addKgRow() {
            kgRowCounter++;
            let avg = $('#avgKg').val() || 0;
            let finishRate = $('#finishType').val() || 300;
            let qty = $('#kgQty').val() || 1;
            let baseAmount = (parseFloat(avg) * parseFloat(finishRate) * parseFloat(qty)).toFixed(2);
            
            let row = $(`
                <tr>
                    <td>${kgRowCounter}</td>
                    <td><input type="number" class="form-control kg-avg" value="${avg}" readonly step="0.01"></td>
                    <td><input type="number" class="form-control kg-rate" value="${finishRate}" readonly></td>
                    <td><input type="number" class="form-control kg-qty" value="${qty}" readonly step="1"></td>
                    <td><input type="number" class="form-control kg-total" value="${baseAmount}" readonly></td>
                    <td><button class="btn btn-add-remove btn-remove" onclick="removeKgRow(this)"><i class="fas fa-times"></i></button></td>
                </tr>
            `);
            $('#kgTable tbody').append(row);
            calcKgGrandTotal();
        }

        function removeKgRow(btn) {
            $(btn).closest('tr').remove();
            calcKgGrandTotal();
        }

        function calcKgGrandTotal() {
            let grand = 0;
            $('#kgTable tbody tr').each(function() {
                let total = parseFloat($(this).find('.kg-total').val()) || 0;
                grand += total;
            });
            $('#kgGrandTotal').text(grand.toFixed(2));
            calcYourTotalCost();
        }

        $('#addKgRow').click(addKgRow);
        $('#kgQty, #finishType').on('input change', function() {
            calcSingleKG();
            if (kgRowCounter > 0) calcKgGrandTotal();
        });

        // SECTION 3: Items Table (UNCHANGED)
        function addItemRow() {
            itemRowCounter++;
            let row = $(`
                <tr>
                    <td>${itemRowCounter}</td>
                    <td><input type="number" class="form-control item-amount" placeholder="Price" min="500" step="0.1"></td>
                    <td><input type="number" class="form-control item-qty" placeholder="QTY" min="1" step="1"></td>
                    <td><input type="number" class="form-control item-total" readonly></td>
                    <td><button class="btn btn-add-remove btn-remove" onclick="removeItemRow(this)"><i class="fas fa-times"></i></button></td>
                </tr>
            `);
            $('#itemsTable tbody').append(row);
        }

        function removeItemRow(btn) {
            $(btn).closest('tr').remove();
            calcGrandTotal();
        }

        function calcRowTotal(row) {
            let amount = parseFloat(row.find('.item-amount').val()) || 0;
            let qty = parseFloat(row.find('.item-qty').val()) || 0;
            if (amount < 0) amount = 0;
            if (qty < 0) qty = 0;
            let total = amount * qty;
            row.find('.item-total').val(total.toFixed(2));
        }

        function calcGrandTotal() {
            let grand = 0;
            $('#itemsTable tbody tr').each(function() {
                calcRowTotal($(this));
                let total = parseFloat($(this).find('.item-total').val()) || 0;
                grand += total;
            });
            $('#grandTotal').text(grand.toFixed(2));
            calcYourTotalCost();
        }

        $('#itemsTable').on('input', '.item-amount, .item-qty', function() {
            calcRowTotal($(this).closest('tr'));
            calcGrandTotal();
        });

        $('#addItemRow').click(addItemRow);

        function calcYourTotalCost() {
            baseAmountTotal = parseFloat($('#kgGrandTotal').text()) || 0;
            let sellingPriceTotal = parseFloat($('#grandTotal').text()) || 0;
            let yourTotalCost = (sellingPriceTotal - baseAmountTotal).toFixed(2);
            
            $('#yourTotalCostDisplay').text(yourTotalCost);
            $('#totalCostInput').val(yourTotalCost);
            $('#showBaseTotal').val(baseAmountTotal.toFixed(2));
            calcProfitLoss();
        }

        function calcProfitLoss() {
            let sell = parseFloat($('#grandTotal').text()) || 0;
            let discount = parseFloat($('#discountInput').val()) || 0;
            
            $('#showTotalSell').val(sell.toFixed(2));
            let discountedPrice = sell - discount;
            $('#discountedPrice').val(discountedPrice.toFixed(2));
            
            let profit = (sell - discount - baseAmountTotal);
            $('#profitAmount').val(profit.toFixed(2));
            
            let percent = (baseAmountTotal > 0 ? (profit / baseAmountTotal * 100) : 0);
            $('#profitPercent').val(percent.toFixed(2) + '%');

            let profitField = $('#profitField');
            let percentField = $('#percentField');
            profitField.removeClass('profit-positive profit-negative');
            percentField.removeClass('profit-positive profit-negative');
            
            if (profit >= 0) {
                profitField.addClass('profit-positive');
                percentField.addClass('profit-positive');
                $('#profitPercent').css('color', 'var(--success)');
            } else {
                profitField.addClass('profit-negative');
                percentField.addClass('profit-negative');
                $('#profitPercent').css('color', 'var(--danger)');
            }
        }

        $('#discountInput').on('input', calcProfitLoss);

        // CSV EXPORT with FontAwesome Icon (UNCHANGED LOGIC)
        $('#exportCsvBtn').on('click', function() {
            const partyName = ($('#partyName').val() || '').replace(/,/g, ' ');
            const dateVal = $('#recordDate').val() || '';
            const timeVal = $('#recordTime').val() || '';

            const baseTotal = parseFloat($('#kgGrandTotal').text()) || 0;
            const sellingTotal = parseFloat($('#grandTotal').text()) || 0;
            const yourTotalCost = parseFloat($('#yourTotalCostDisplay').text()) || 0;
            const discount = parseFloat($('#discountInput').val()) || 0;
            const discountedPrice = parseFloat($('#discountedPrice').val()) || 0;
            const profitAmount = parseFloat($('#profitAmount').val()) || 0;
            const profitPercent = $('#profitPercent').val() || '0%';

            let csv = 'Party Name,Date,Time,Base Amount Total,Selling Price Total,Your Total Cost,Discount,Discounted Price,Profit/Loss Amount,Profit/Loss %\n';
            csv += `"${partyName}","${dateVal}","${timeVal}",${baseTotal.toFixed(2)},${sellingTotal.toFixed(2)},${yourTotalCost.toFixed(2)},${discount.toFixed(2)},${discountedPrice.toFixed(2)},${profitAmount.toFixed(2)},"${profitPercent}"\n`;

            csv += '\n"KG Rows: "\nRow,Avg KG,Finish Rate,Qty,Base Amount\n';
            $('#kgTable tbody tr').each(function(index) {
                const avg = parseFloat($(this).find('.kg-avg').val()) || 0;
                const rate = parseFloat($(this).find('.kg-rate').val()) || 0;
                const qty = parseFloat($(this).find('.kg-qty').val()) || 0;
                const total = parseFloat($(this).find('.kg-total').val()) || 0;
                csv += `${index+1},${avg.toFixed(2)},${rate.toFixed(2)},${qty.toFixed(0)},${total.toFixed(2)}\n`;
            });

            csv += '\n"Item Rows: "\nRow,Price,Qty,Line Total\n';
            $('#itemsTable tbody tr').each(function(index) {
                const price = parseFloat($(this).find('.item-amount').val()) || 0;
                const qty = parseFloat($(this).find('.item-qty').val()) || 0;
                const total = parseFloat($(this).find('.item-total').val()) || 0;
                csv += `${index+1},${price.toFixed(2)},${qty.toFixed(0)},${total.toFixed(2)}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const safeParty = partyName || 'Party';
            const fileName = `${safeParty.replace(/[^a-zA-Z0-9_-]/g, '')}_${dateVal || 'date'}_${timeVal.replace(':','') || 'time'}.csv`;
            
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
    </script>
</body>
</html>
